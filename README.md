# Unicorn App

A Next.js application where users can create animated 3D unicorns that bounce around the screen. Built with React Three Fiber, Supabase, and Rapier physics.

## Features

- User authentication with Supabase
- Create 3D unicorns with randomized features (colors, accessories, hair styles)
- Rainbow particle effects overlay
- Physics-based bouncing unicorns
- Persistent unicorn storage
- User profile with statistics

## Tech Stack

- **Framework**: Next.js 14+ (App Router)
- **Database & Auth**: Supabase
- **ORM**: Drizzle ORM
- **3D Rendering**: React Three Fiber (@react-three/fiber, @react-three/drei)
- **Physics**: @react-three/rapier
- **Styling**: Tailwind CSS

## Setup

### 1. Install Dependencies

```bash
pnpm install
```

### 2. Set Up Supabase

1. Create a new project at [supabase.com](https://supabase.com)
2. Go to Project Settings > API to get your project URL and anon key
3. Go to Project Settings > Database > Connection string to get your database connection string (use the "URI" format)
4. Create a `.env.local` file in the root directory:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres
```

### 3. Run Database Migration

1. Generate the initial migration from the schema:

   ```bash
   pnpm db:generate
   ```

2. Apply the migration to your database:
   ```bash
   pnpm db:migrate
   ```

This will create:

- The `unicorns` table with proper schema
- Indexes for performance

**Note**: Row Level Security (RLS) policies should be added manually via SQL in the Supabase dashboard, as Drizzle doesn't handle RLS policies directly.

### 4. Run Development Server

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser.

## Database Management

This project uses [Drizzle ORM](https://orm.drizzle.team/) for type-safe database schema management and migrations.

### Migration Scripts

- `pnpm db:generate` - Generate migration files from schema changes in `src/lib/db/schema.ts`
- `pnpm db:migrate` - Apply pending migrations to the database
- `pnpm db:push` - Push schema changes directly to the database (development only, bypasses migrations)
- `pnpm db:studio` - Open Drizzle Studio for visual database inspection and querying
- `pnpm db:drop` - Drop all tables (development only, use with caution)

### Workflow for Database Changes

1. **Modify the schema** in `src/lib/db/schema.ts`
2. **Generate migration**: Run `pnpm db:generate` to create migration files in `supabase/migrations/`
3. **Review the migration**: Check the generated SQL files to ensure they're correct
4. **Apply migration**: Run `pnpm db:migrate` to apply changes to your database

**Example workflow:**

```bash
# 1. Edit src/lib/db/schema.ts to add/modify tables or columns
# 2. Generate migration
pnpm db:generate

# 3. Review the generated migration files in supabase/migrations/
# 4. Apply the migration
pnpm db:migrate
```

**For quick development iterations**, you can use `pnpm db:push` to sync schema changes directly without creating migration files. However, always use migrations for production deployments.

### Schema Location

The database schema is defined in `src/lib/db/schema.ts`. Import the schema and database instance from `src/lib/db/index.ts` in your application code.

## Project Structure

- `src/app/` - Next.js app router pages
- `src/components/` - React components (Unicorn, ParticleRainbow, etc.)
- `src/lib/` - Utilities (Supabase client, unicorn services, feature generation)
  - `src/lib/db/` - Database schema and connection (Drizzle ORM)
- `src/contexts/` - React contexts (AuthContext)
- `supabase/migrations/` - Database migration files (generated by Drizzle)

## Deployment

The app is ready to deploy on Vercel:

1. Push your code to GitHub
2. Import the project in Vercel
3. Add your Supabase environment variables in Vercel settings:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `DATABASE_URL` (for running migrations if needed)
4. Deploy!

**Note**: Make sure to run `pnpm db:migrate` on your production database after deployment, or set up a migration step in your CI/CD pipeline.

## License

See LICENSE file for details.
